(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{390:function(s,n,t){"use strict";t.r(n);var a=t(3),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),t("p",[s._v("终端连接远程 SSH 服务，经常会出现长时间无操作后就自动断开，或者无响应，无法再通过键盘输入，再过一会就自动断开了。特别烦的就是有时候 vim 在编辑一个文本，编辑到一半，还没保存，就卡住了。只能强行断开重连，重新编辑，如果直接再敲一次 vim，还会返回一个 "),t("code",[s._v('Swap file ".xx.swp" already exists')]),s._v(" 错误。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("E325: ATTENTION\nFound a swap "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" by the name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".ss.json.swp"')]),s._v("\n          owned by: bingo   dated: Thu Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" 02:03:25 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" name: ~bingo/Desktop/ss.json\n          modified: no\n         user name: bingo   "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" name: bingo-mbp.com\n        process ID: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8542")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("still running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nWhile opening "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ss.json"')]),s._v("\n             dated: Tue Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" 02:12:57 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Another program may be editing the same file.  If this is the case,\n    be careful not to end up with two different instances of the same\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" when making changes.  Quit, or "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" with caution.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" An edit session "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" crashed.\n    If this is the case, use "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":recover"')]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vim -r ss.json"')]),s._v("\n    to recover the changes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("see "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":help recovery"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n    If you did this already, delete the swap "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".ss.json.swp"')]),s._v("\n    to avoid this message.\n\nSwap "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".ss.json.swp"')]),s._v(" already exists"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("O"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("pen Read-Only, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("E"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("dit anyway, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("R"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("ecover, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Q"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("uit, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("A"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("bort:\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("要么先删了这个 .swp 文件，再 vim 进行编辑。")]),s._v(" "),t("li",[s._v("要么就出现这个 ATTENTION 的时候，敲 E (Edit anyway)，再继续编辑。")])]),s._v(" "),t("p",[s._v("但仔细想一想，为什么要做这些没必要的操作？归根到底，就是因为断开了连接。那么问题来了，如何保持 SSH 连接不断开，或者断开连接后自动重连？")]),s._v(" "),t("h2",{attrs:{id:"解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),t("h3",{attrs:{id:"方法一-客户端发送心跳"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一-客户端发送心跳"}},[s._v("#")]),s._v(" 方法一 客户端发送心跳")]),s._v(" "),t("p",[s._v("依赖 ssh 客户端定时发送心跳，putty、SecureCRT、XShell 都有这个功能，但是目测不太好用。")]),s._v(" "),t("p",[s._v("Linux / Unix 下，编辑 ssh 配置文件：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ssh/ssh_config\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加")]),s._v("\nServerAliveInterval "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nServerAliveCountMax "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("999")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("ServerAliveInterval")]),s._v("表示每隔多少秒，从客户端向服务器端发送一次心跳（alive 检测）。")]),s._v(" "),t("li",[t("code",[s._v("ServerAliveCountMax")]),s._v("表示服务端多少次心跳无响应之后，客户端才会认为与服务器的 SSH 连接已经断开，然后断开连接。")])]),s._v(" "),t("p",[s._v("上述配置则表示：每隔20秒，向服务器发出一次心跳。若超过999次请求都没有发送成功，则会主动断开与服务器端的连接。")]),s._v(" "),t("h3",{attrs:{id:"方法二-服务器端发送心跳"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二-服务器端发送心跳"}},[s._v("#")]),s._v(" 方法二 服务器端发送心跳")]),s._v(" "),t("p",[s._v("方法一改在客户端，方法二改在服务器端。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ssh/sshd_config\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加")]),s._v("\nClientAliveInterval "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nClientAliveCountMax "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("ClientAliveInterval")]),s._v("表示每隔多少秒，从服务器端向客户端发送一次心跳。")]),s._v(" "),t("li",[t("code",[s._v("ClientAliveInterval")]),s._v("表示客户端多少次心跳无响应之后，服务端才会认为客户端已经断开连接，然后断开连接。")])]),s._v(" "),t("p",[s._v("上述配置则表示：每隔60秒，服务器向客户端发出一次心跳。若客户端超过3次请求未响应，则会从服务器端断开与客户端的连接。所以，总共允许无响应的时间是 60 * 3 = 180 秒以内。")]),s._v(" "),t("h2",{attrs:{id:"后话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后话"}},[s._v("#")]),s._v(" 后话")]),s._v(" "),t("p",[s._v("至于使用方法一还是方法二，看情况吧，本质上没什么区别。")]),s._v(" "),t("ul",[t("li",[s._v("如果只想满足自己的需求，就在自己电脑上使用方法一。")]),s._v(" "),t("li",[s._v("如果作为运维，想照顾可能会连上服务器的用户们，就再在自己服务器上使用方法二。")])]),s._v(" "),t("p",[s._v("上述配置后，我做了个简单测试。连接美国洛杉矶的搬瓦工vps，ssh 连上后，不做任何操作，目前已经维持连接3天整，没有任何问题。中间还经历了几次短时间断网（几十秒），也都自动恢复了。")])])}),[],!1,null,null,null);n.default=e.exports}}]);