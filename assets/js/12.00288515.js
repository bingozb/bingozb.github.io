(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{338:function(a,e,s){"use strict";s.r(e);var t=s(4),n=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"插入emoji表情报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插入emoji表情报错"}},[a._v("#")]),a._v(" 插入emoji表情报错")]),a._v(" "),s("p",[a._v("一般情况下，往数据库插入emoji字符，会报类似如下的错误:")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Error 1366: Incorrect string value: '\\xF0\\x9F\\x91\\xBD\\xF0\\x9F...' for column 'xxx'\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("Google说MySQL的utf8不是真正的UTF8，只能包含3个字节的unicode，4个字节就会报错。解决这个问题要使用"),s("code",[a._v("utf8mb4")]),a._v("这个编码。")]),a._v(" "),s("ul",[s("li",[a._v("mysql 5.5.3 版本之前，utf8编码最多支持3个字节，也就是BMP这部分的编码区，范围0000～FFFF这一部分。")]),a._v(" "),s("li",[a._v("mysql 5.5.3 之后的版本，增加utf8mb4，官方介绍它是向下兼容utf8字符集，比utf8能标示更多的字符。\n")])]),a._v(" "),s("h2",{attrs:{id:"解决方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[a._v("#")]),a._v(" 解决方法")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("检查MySQL版本，如果版本低于5.5.3,请先升级数据库。")])]),a._v(" "),s("li",[s("p",[a._v("以linux服务器为例，找到数据库配置文件"),s("code",[a._v("my.cnf")]),a._v("，编辑在对应标签下添加参数。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim /etc/my.cnf\n\n[client]\ndefault-character-set = utf8mb4\n\n[mysql]\ndefault-character-set = utf8mb4\n\n[mysqld]\ncharacter-set-client-handshake = FALSE\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\ninit_connect = 'SET NAMES utf8mb4'\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("修改 database、table 和 column字符集 （根据情况决定）")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;\n\n$ ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n\n$ ALTER TABLE table_name CHANGE column_name VARCHAR(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("重启服务")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ sudo /etc/init.d/mysql restart\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("检查字符集")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysql> SHOW VARIABLES WHERE Variable_name LIKE 'character\\_set\\_%' OR Variable_name LIKE 'collation%';\n+--------------------------+--------------------+\n| Variable_name            | Value              |\n+--------------------------+--------------------+\n| character_set_client     | utf8mb4            |\n| character_set_connection | utf8mb4            |\n| character_set_database   | utf8mb4            |\n| character_set_filesystem | binary             |\n| character_set_results    | utf8mb4            |\n| character_set_server     | utf8mb4            |\n| character_set_system     | utf8               |\n| collation_connection     | utf8mb4_unicode_ci |\n| collation_database       | utf8mb4_unicode_ci |\n| collation_server         | utf8mb4_unicode_ci |\n+--------------------------+--------------------+\n10 rows in set (0.01 sec)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("必须要保证 "),s("code",[a._v("character_set_client")]),a._v("、"),s("code",[a._v("character_set_connection")]),a._v("、"),s("code",[a._v("character_set_database")]),a._v("、"),s("code",[a._v("character_set_results")]),a._v("、"),s("code",[a._v("character_set_server")]),a._v(" 这五个的值为"),s("code",[a._v("utf8mb4")]),a._v("。")])])]),a._v(" "),s("h2",{attrs:{id:"额外补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#额外补充"}},[a._v("#")]),a._v(" 额外补充")]),a._v(" "),s("ul",[s("li",[a._v("如果使用"),s("code",[a._v("jdbc-url")]),a._v("进行连接，characterEncoding不支持写utf8mb4，写法不变。"),s("code",[a._v("characterEncoding=utf8")]),a._v("可以被自动被识别为"),s("code",[a._v("utf8mb4")]),a._v("，兼容原来的"),s("code",[a._v("utf8")]),a._v("。")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("jdbc:mysql://localhost:3306/database?useUnicode=true&characterEncoding=utf8\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("如果是新建的数据库，一般不会有什么问题，如果是从utf8改成utf8mb4的旧数据库，可能会出现插入依然报错的情况。这时候只需要把url中的"),s("code",[a._v("characterEncoding=utf8")]),a._v("去掉。")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("jdbc:mysql://localhost:3306/database?useUnicode=true\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("如果还有其他诸如中文插入乱码的问题，提供一种可行性很高的解决方法，即更新数据库连接驱动包，附上官网下载链接 "),s("a",{attrs:{href:"http://dev.mysql.com/downloads/file/?id=456317",target:"_blank",rel:"noopener noreferrer"}},[a._v("mysql-connector-java-5.1.35.zip"),s("OutboundLink")],1),a._v("；再不行就把url中"),s("code",[a._v("characterEncoding=utf8")]),a._v("的"),s("code",[a._v("utf8")]),a._v("改为"),s("code",[a._v("gbk")]),a._v("。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);