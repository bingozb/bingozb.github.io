(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{395:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",[s._v("记录阿里云 ECS 磁盘在线扩容过程。")])]),s._v(" "),e("h2",{attrs:{id:"为什么需要磁盘扩容？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要磁盘扩容？"}},[s._v("#")]),s._v(" 为什么需要磁盘扩容？")]),s._v(" "),e("p",[s._v("我们刚购买服务器的时候，可能没办法很准确地预估将来服务器上边需要储存多少东西，就没有太关注磁盘容量，也许就没有修改默认值（40G）。")]),s._v(" "),e("p",[s._v("当服务器运行一段时间，不断产生数据，有一天就会发现磁盘快占满了，那么服务器上运行的一些服务比如 Jenkins、ELK 等等，可能都会报错，无法正常运行。")]),s._v(" "),e("p",[s._v("这个时候就需要进行扩容了。")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/blog/67/before.png",alt:"before"}})]),s._v(" "),e("h2",{attrs:{id:"磁盘扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#磁盘扩容"}},[s._v("#")]),s._v(" 磁盘扩容")]),s._v(" "),e("p",[s._v("登录阿里云控制台，选择服务器实例，再选择本实例云盘，可以看到当前服务器的云盘信息，在最右边点击更多，选择磁盘扩容。")]),s._v(" "),e("p",[s._v("在跳转出来的确认订单页面中，勾选上在线扩容选项，然后输入自己想要的扩容后的容量，然后点击确认扩容，进行支付。")]),s._v(" "),e("p",[s._v("这一步很简单，但这只是扩容数据盘，只是这样操作的话，扩容还没有生效，需要再做后续的操作。")]),s._v(" "),e("h2",{attrs:{id:"扩展分区和文件系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#扩展分区和文件系统"}},[s._v("#")]),s._v(" 扩展分区和文件系统")]),s._v(" "),e("p",[s._v("我的服务器是 Linux 系统，CentOS 7.2，这里记录对应的操作方法。")]),s._v(" "),e("h3",{attrs:{id:"安装扩容格式化工具-growpart"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装扩容格式化工具-growpart"}},[s._v("#")]),s._v(" 安装扩容格式化工具 growpart")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo yum install -y cloud-utils-growpart\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看现有云盘大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看现有云盘大小"}},[s._v("#")]),s._v(" 查看现有云盘大小")]),s._v(" "),e("p",[s._v("运行 "),e("code",[s._v("fdisk -l")]),s._v(" 命令查看现有云盘大小。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ sudo fdisk -l\n\n磁盘 /dev/vda：53.7 GB, 53687091200 字节，104857600 个扇区\nUnits = 扇区 of 1 * 512 = 512 bytes\n扇区大小(逻辑/物理)：512 字节 / 512 字节\nI/O 大小(最小/最佳)：512 字节 / 512 字节\n磁盘标签类型：dos\n磁盘标识符：0x000d2717\n\n   设备 Boot      Start         End      Blocks   Id  System\n/dev/vda1   *        2048    83884031    41940992   83  Linux\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("返回云盘（/dev/vda）容量是50GiB。")]),s._v(" "),e("h3",{attrs:{id:"查看云盘分区大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看云盘分区大小"}},[s._v("#")]),s._v(" 查看云盘分区大小")]),s._v(" "),e("p",[s._v("运行 "),e("code",[s._v("df -h")]),s._v(" 命令查看云盘分区大小。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ sudo df -h\n文件系统        容量  已用  可用 已用% 挂载点\n/dev/vda1        40G   36G  2.0G   95% /\ndevtmpfs        3.9G     0  3.9G    0% /dev\ntmpfs           3.9G     0  3.9G    0% /dev/shm\ntmpfs           3.9G  2.1M  3.9G    1% /run\ntmpfs           3.9G     0  3.9G    0% /sys/fs/cgroup\noverlay          40G   36G  2.0G   95% /var/lib/docker/overlay2/b658787d26f70caa38ba98f9ea6672fb54c5dc8977db417920efa64dd31bcdee/merged\n//...\ntmpfs           783M     0  783M    0% /run/user/1000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("返回分区（/dev/vda1）容量是40GiB。")]),s._v(" "),e("h3",{attrs:{id:"分区扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分区扩容"}},[s._v("#")]),s._v(" 分区扩容")]),s._v(" "),e("p",[s._v("运行 "),e("code",[s._v("growpart <DeviceName> <PartionNumber>")]),s._v(" 命令，调用 "),e("code",[s._v("growpart")]),s._v(" 为需要扩容的云盘和对应的第几个分区扩容。")]),s._v(" "),e("p",[e("code",[s._v("growpart /dev/vda 1")]),s._v(" ，表示为系统盘的第一个分区（/dev/vda1）扩容。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ sudo growpart /dev/vda 1\nunexpected output in sfdisk --version [sfdisk，来自 util-linux 2.23.2]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("返回了这个报错，可以运行 "),e("code",[s._v("LANG=en_US.UTF-8")]),s._v(" 切换ECS实例的字符编码类型，然后再进行尝试。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ LANG=en_US.UTF-8\n[deploy@macrowolf ~]$ sudo growpart /dev/vda 1\nCHANGED: partition=1 start=2048 old: size=83881984 end=83884032 new: size=104855519 end=104857567\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"扩容文件系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#扩容文件系统"}},[s._v("#")]),s._v(" 扩容文件系统")]),s._v(" "),e("p",[s._v("运行 "),e("code",[s._v("resize2fs <PartitionName>")]),s._v(" 命令调用 "),e("code",[s._v("resize2fs")]),s._v(" 扩容文件系统。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ sudo resize2fs /dev/vda1\nresize2fs 1.42.9 (28-Dec-2013)\nFilesystem at /dev/vda1 is mounted on /; on-line resizing required\nold_desc_blocks = 3, new_desc_blocks = 4\nThe filesystem on /dev/vda1 is now 13106939 blocks long.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"再次查看云盘分区大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#再次查看云盘分区大小"}},[s._v("#")]),s._v(" 再次查看云盘分区大小")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[deploy@macrowolf ~]$ sudo df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        50G   36G   12G  76% /\ndevtmpfs        3.9G     0  3.9G   0% /dev\ntmpfs           3.9G     0  3.9G   0% /dev/shm\ntmpfs           3.9G  2.1M  3.9G   1% /run\ntmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup\noverlay          50G   36G   12G  76% /var/lib/docker/overlay2/b658787d26f70caa38ba98f9ea6672fb54c5dc8977db417920efa64dd31bcdee/merged\n//...\ntmpfs           783M     0  783M   0% /run/user/1000\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("可以看到分区（/dev/vda1）容量已经是50GiB，表示已经成功扩容。")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/blog/67/after.png",alt:"after"}})]),s._v(" "),e("p",[s._v("在整个过程中，无需重启服务器，所以不会影响到服务器上正在运行的服务。")])])}),[],!1,null,null,null);a.default=t.exports}}]);