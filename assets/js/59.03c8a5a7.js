(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{389:function(s,e,a){"use strict";a.r(e);var t=a(4),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("前面一篇文章说到，如果要更改 /etc/sudoers 里的内容，比如设置用户 sudo 操作免密码验证等，最好先切换到 root 用户，再进行编辑，最后强制保存。如果不这么做，而使用 chmod 来更改权限，就会导致之后的 sudo 操作全部被拒绝。")]),s._v(" "),a("h2",{attrs:{id:"问题与解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题与解决"}},[s._v("#")]),s._v(" 问题与解决")]),s._v(" "),a("p",[s._v("问题是这样的，我需要编辑 /etc/sudoers 文件，想让当前用户使用 sudo 操作可以免密码验证，但是保存不了，一直提示文件是只读的，"),a("code",[s._v(":wq!")]),s._v(" 强制保存也不行，提示文件不属于当前用户所拥有。")]),s._v(" "),a("p",[s._v("于是敲了一句 chmod：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+w /etc/sudoers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改了 /etc/sudoers 的权限，再用 sudo 命令的时候，必定会出现报错：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo: /etc/sudoers is owned by uid 501, should be 0\nsudo: no valid sudoers sources found, quitting\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("501 是我当前登录的用户 bingo，而 0 应该是 root 用户。")]),s._v(" "),a("p",[s._v("网上的解决方案是进入 recovery mode，将 sudoers 的权限修改回来。但我不相信必须要这么做，想先尝试看能不能改得回来。")]),s._v(" "),a("p",[s._v("于是将 /etc/sudoers 的 owner 和组，修改为 admin:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:admin /etc/sudoers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行这一句命令时出现一个报错：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ chown: /etc/sudoers: Operation not permitted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("那这就很尴尬了，sudo 本来就已经不能用了，怎么办？")]),s._v(" "),a("p",[s._v("幸好，在 macOS 上还可以开启 root 用户：\n系统偏好设置 -> 用户与群组 -> 登录选项 -> 网络账户服务器 -> 加入 -> 打开目录实用工具 -> 解锁 -> 顶部菜单栏 -> 编辑 -> 启用 Root 用户。")]),s._v(" "),a("p",[s._v("然后终端 su root 切换到 root 用户，此时拥有最高权限，任何操作都要慎重。")]),s._v(" "),a("p",[s._v("再次执行原来那句命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" root:admin /etc/sudoers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("就不会有 Operation not permitted 的报错了，然后 exit 退出 root 用户后，随便执行一句 sudo 操作命令，又出现另外一个报错：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo: /etc/sudoers is world writable\nsudo: no valid sudoers sources found, quitting\nsudo: unable to initialize policy plugin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这个好解决，应该还是 /etc/sudoers 的权限问题，继续 su 切换到 root 用户，然后改权限：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("555")]),s._v(" /etc/sudoers\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("然后再随便敲一句 sudo，没有报错，问题已解决。")]),s._v(" "),a("h2",{attrs:{id:"后话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后话"}},[s._v("#")]),s._v(" 后话")]),s._v(" "),a("p",[s._v("这是一个教训，/etc/sudoers 这个文件千万不要随便乱动。为了保护系统安全，sudoers 的权限一旦修改后，任何 sudo 命令都会被拒绝。")]),s._v(" "),a("p",[s._v("如果真的要编辑，就切换到 root 用户再进行操作，千万不要随便更改权限。否则，代价可能是非常巨大的。")])])}),[],!1,null,null,null);e.default=n.exports}}]);