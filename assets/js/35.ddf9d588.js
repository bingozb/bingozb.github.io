(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{363:function(s,a,e){"use strict";e.r(a);var n=e(4),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("网络层是 APP 架构的一个重要部分，苹果的 CFNetwork 框架极其难用，导致基于 CFN 的框架 ASI 已经放弃维护。后来苹果推出了 NSURLSession，许多开源的框架都是基于它进行封装，例如我选用的 AFNetworking，运行效率没有 ASI 高，使用比 ASI 简单。但是，从使用的角度来看，还需要继续封装。于是，我依赖于 AFN + YYCache + MJExtension 封装出了 "),e("a",{attrs:{href:"https://github.com/bingozb/DKNetworking/",target:"_blank",rel:"noopener noreferrer"}},[s._v("DKNetworking"),e("OutboundLink")],1),s._v(" 框架。")]),s._v(" "),e("h2",{attrs:{id:"特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("DKNetworkSessionManager 对 AFHTTPSessionManager 进行封装，以便以后可以轻易换掉依赖的 AFN。封装一层底层方法，包括网络请求、文件上传、文件下载这三个方法。其中网络请求调用了 AFN 的私有 API，把 GET、POST、PUT、DELETE、PATCH 这五个方法封成了一个 request 方法。")])]),s._v(" "),e("li",[e("p",[s._v("拥有 AFN 大部分常用功能，包括网络状态监听等，提供类方法和实例方法调用。")])]),s._v(" "),e("li",[e("p",[s._v("根据 JavaWeb 中 HttpServlet 的设计思想，把网络请求的回调封装成了 request 和 response 两个对象。")])]),s._v(" "),e("li",[e("p",[s._v("支持界面多级缓存。")])]),s._v(" "),e("li",[e("p",[s._v("支持链式调用。")])]),s._v(" "),e("li",[e("p",[s._v("支持配合 RAC 框架使用链式调用，支持自定义信号的返回值。")])])]),s._v(" "),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("h3",{attrs:{id:"支持-cocoapods-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持-cocoapods-安装"}},[s._v("#")]),s._v(" 支持 Cocoapods 安装")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("pod 'DKNetworking'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"或者下载-demo-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#或者下载-demo-项目"}},[s._v("#")]),s._v(" 或者下载 Demo 项目")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("将根目录下的 DKNetworking 和 Vendor 文件夹拉进项目，其中 Vendor 文件夹有 AFNetworking、MJExtension、YYCache 和 ReactiveCocoa，前三个是必须依赖的，ReactiveCocoa 是可选的。")])]),s._v(" "),e("li",[e("p",[s._v("必须在 Target -> Build Phases -> Link Binary With Libraries 中添加 "),e("code",[s._v("libsqlite3.0.tbd")]),s._v("，这是 YYCache 框架所需的。")])])]),s._v(" "),e("h2",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("p",[s._v("绝大部分方法都可以直接看 DKNetworking.h 中的声明以及注释。")]),s._v(" "),e("h3",{attrs:{id:"获取单例对象"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取单例对象"}},[s._v("#")]),s._v(" 获取单例对象")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("DKNetworking *networking = [DKNetworking networkManager];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("从 1.1.0 版本开始提供了一个单例对象宏 "),e("code",[s._v("DKNetworkManager")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"dkn-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dkn-配置"}},[s._v("#")]),s._v(" DKN 配置")]),s._v(" "),e("h4",{attrs:{id:"设置请求根路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置请求根路径"}},[s._v("#")]),s._v(" 设置请求根路径")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('[DKNetworking setupBaseURL:@"https://m.sfddj.com/app/v1/"];\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("baseURL 的路径一定要有“/”结尾，设置后所有的网络访问都使用相对路径。")]),s._v(" "),e("h4",{attrs:{id:"设置日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置日志"}},[s._v("#")]),s._v(" 设置日志")]),s._v(" "),e("h5",{attrs:{id:"开启日志打印"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启日志打印"}},[s._v("#")]),s._v(" 开启日志打印")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworking openLog];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"关闭日志打印"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭日志打印"}},[s._v("#")]),s._v(" 关闭日志打印")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworking closeLog];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"设置缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置缓存"}},[s._v("#")]),s._v(" 设置缓存")]),s._v(" "),e("h5",{attrs:{id:"设置缓存方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置缓存方式"}},[s._v("#")]),s._v(" 设置缓存方式")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置缓存方式\n DKNetworkCacheTypeNetworkOnly : 只加载网络数据\n DKNetworkCacheTypeCacheNetwork : 先加载缓存,然后加载网络\n @param cacheType 缓存类型\n */\n+ (void)setupCacheType:(DKNetworkCacheType)cacheType;\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h5",{attrs:{id:"获取缓存大小"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取缓存大小"}},[s._v("#")]),s._v(" 获取缓存大小")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 获取网络缓存的总大小 动态单位(GB,MB,KB,B)\n\n @return 网络缓存的总大小\n */\n+ (NSString *)cacheSize;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h5",{attrs:{id:"清除缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#清除缓存"}},[s._v("#")]),s._v(" 清除缓存")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworkCache clearCache];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"设置序列化格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置序列化格式"}},[s._v("#")]),s._v(" 设置序列化格式")]),s._v(" "),e("h5",{attrs:{id:"设置请求序列化格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置请求序列化格式"}},[s._v("#")]),s._v(" 设置请求序列化格式")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置网络请求参数的格式 : 默认为二进制格式\n\n @param requestSerializer DKRequestSerializerJSON:JSON格式, DKRequestSerializerHTTP:二进制格式\n */\n+ (void)setRequestSerializer:(DKRequestSerializer)requestSerializer;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h5",{attrs:{id:"设置响应反序列化格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置响应反序列化格式"}},[s._v("#")]),s._v(" 设置响应反序列化格式")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置服务器响应数据格式 : 默认为JSON格式\n\n @param responseSerializer DKResponseSerializerJSON:JSON格式, DKResponseSerializerHTTP:二进制格式\n */\n+ (void)setResponseSerializer:(DKResponseSerializer)responseSerializer;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"设置请求超时时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置请求超时时间"}},[s._v("#")]),s._v(" 设置请求超时时间")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置请求超时时间 : 默认10秒\n\n @param time 请求超时时长(秒)\n */\n+ (void)setRequestTimeoutInterval:(NSTimeInterval)time;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"设置-header"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置-header"}},[s._v("#")]),s._v(" 设置 Header")]),s._v(" "),e("h5",{attrs:{id:"设置一对请求头参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置一对请求头参数"}},[s._v("#")]),s._v(" 设置一对请求头参数")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置一对请求头参数\n\n @param value 请求头参数值\n @param field 请求头参数名\n */\n+ (void)setValue:(NSString *)value forHTTPHeaderField:(NSString *)field;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h5",{attrs:{id:"设置多对请求头参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置多对请求头参数"}},[s._v("#")]),s._v(" 设置多对请求头参数")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 设置多对请求头参数\n\n @param networkHeader 请求头参数字典\n */\n+ (void)setNetworkHeader:(NSDictionary *)networkHeader;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"网络状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网络状态"}},[s._v("#")]),s._v(" 网络状态")]),s._v(" "),e("h4",{attrs:{id:"监听网络状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监听网络状态"}},[s._v("#")]),s._v(" 监听网络状态")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworking networkStatusWithBlock:^(DKNetworkStatus status) {\n    switch (status) {\n        case DKNetworkStatusUnknown: // 网络状态未知\n            break;\n        case DKNetworkStatusNotReachable: // 无网络\n            break;\n        case DKNetworkStatusReachableViaWWAN: // 手机网络（蜂窝）\n            break;\n        case DKNetworkStatusReachableViaWiFi: // WIFI网络\n            break;\n    }\n}];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h4",{attrs:{id:"获取当前网络状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取当前网络状态"}},[s._v("#")]),s._v(" 获取当前网络状态")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 有网络:YES, 无网络:NO\n */\n+ (BOOL)isNetworking;\n\n/**\n 手机网络:YES, 非手机网络:NO\n */\n+ (BOOL)isWWANNetwork;\n\n/**\n WiFi网络:YES, 非WiFi网络:NO\n */\n+ (BOOL)isWiFiNetwork;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"网络请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网络请求"}},[s._v("#")]),s._v(" 网络请求")]),s._v(" "),e("h4",{attrs:{id:"常规调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常规调用"}},[s._v("#")]),s._v(" 常规调用")]),s._v(" "),e("p",[e("strong",[s._v("以 POST 方法为例，方法定义：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n POST请求\n \n @param URL 请求地址\n @param parameters 请求参数\n @param callback 请求回调\n @return 返回的对象可取消请求,调用cancel方法\n */\n+ (NSURLSessionTask *)POST:(NSString *)URL parameters:(NSDictionary *)parameters callback:(DKNetworkBlock)callback;\n- (NSURLSessionTask *)POST:(NSString *)URL parameters:(NSDictionary *)parameters callback:(DKNetworkBlock)callback;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[e("strong",[s._v("调用：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('[DKNetworking POST:url parameters:@{@"name":@"bingo"} callback:^(DKNetworkRequest *request, DKNetworkResponse *response) {\n    // ...\n}];\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h4",{attrs:{id:"链式调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链式调用"}},[s._v("#")]),s._v(" 链式调用")]),s._v(" "),e("p",[e("strong",[s._v("方法定义：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/** 链式调用 */\n- (DKNetworking *(^)(NSString *url))get;\n- (DKNetworking *(^)(NSString *url))post;\n- (DKNetworking *(^)(NSString *url))put;\n- (DKNetworking *(^)(NSString *url))delete;\n- (DKNetworking *(^)(NSString *url))patch;\n- (DKNetworking *(^)(NSDictionary *params))params;\n- (DKNetworking *(^)(NSDictionary *header))header;\n- (DKNetworking *(^)(DKNetworkCacheType cacheType))cacheType;\n- (DKNetworking *(^)(DKRequestSerializer requestSerializer))requestSerializer;\n- (DKNetworking *(^)(DKResponseSerializer responseSerializer))responseSerializer;\n- (DKNetworking *(^)(DKRequestTimeoutInterval requestTimeoutInterval))requestTimeoutInterval;\n- (void(^)(DKNetworkBlock networkBlock))callback;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[e("strong",[s._v("调用：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('DKNetworkManager.post(url).params(@{@"name":@"bingo"}).callback(^(DKNetworkRequest *request, DKNetworkResponse *response) {\n    // ...\n});\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h4",{attrs:{id:"rac-链式调用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rac-链式调用"}},[s._v("#")]),s._v(" RAC 链式调用")]),s._v(" "),e("p",[e("strong",[s._v("方法定义：")])]),s._v(" "),e("p",[s._v("在原链式方法的基础上补充了一个 executeSignal 方法，返回信号。")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#ifdef RAC\n/** RAC链式发送请求 */\n- (RACSignal *)executeSignal;\n#endif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("调用：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('[DKNetworkManager.post(url).params(@{@"name":@"bingo"}).executeSignal subscribeNext:^(RACTuple *x) {\n    DKNetworkResponse *response = x.second;\n    // ...\n} error:^(NSError *error) {\n    // ...\n}];\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h4",{attrs:{id:"rac-链式调用-自定义信号的返回值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rac-链式调用-自定义信号的返回值"}},[s._v("#")]),s._v(" RAC 链式调用 自定义信号的返回值")]),s._v(" "),e("p",[e("strong",[s._v("方法定义：")])]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#ifdef RAC\n/**\n 设置响应结果回调，可以设置信号返回的value为自己想要的值，比如用MJExtension框架，将DKNetworkResponse对象的rawData字典转为自己项目的实体类再返回\n \n @param flattenMapBlock 结果映射的设置回调block，其中RACTuple的first为DKNetworkRequest对象，second为DKNetworkResponse对象\n */\n+ (void)setupResponseSignalWithFlattenMapBlock:(DKNetworkFlattenMapBlock)flattenMapBlock;\n#endif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("使用：")])]),s._v(" "),e("p",[s._v("考虑到代码执行顺序的问题，建议在项目中创建一个继承自 NSObject 的类 DKNetworkConfig，在 + load 方法中调用 DKN 的配置方法，设置回调的信号的 return 值，根据不同项目进行配置。")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworking setupResponseSignalWithFlattenMapBlock:^RACStream *(RACTuple *tuple) {\n    DKNetworkResponse *response = tuple.second; // 框架默认返回的response\n    MyHttpResponse *myResponse = [MyHttpResponse mj_objectWithKeyValues:response.rawData]; // 项目需要的response\n    myResponse.rawData = response.rawData;\n    myResponse.error = response.error;\n    return [RACSignal return:RACTuplePack(tuple.first, myResponse)];\n}];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[e("strong",[s._v("调用：")])]),s._v(" "),e("p",[s._v("经过上面的"),e("code",[s._v("setupResponseSignalWithFlattenMapBlock:")]),s._v("方法设置后，信号返回的 RACTuple 的 second 为自定义的 response 对象。")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("[DKNetworkManager.post(url).executeSignal subscribeNext:^(RACTuple *x) {\n//        DKNetworkResponse *response = x.second;\n    MyHttpResponse *myResponse = x.second;\n    // ...\n} error:^(NSError *error) {\n    // ...\n}];\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h4",{attrs:{id:"取消请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#取消请求"}},[s._v("#")]),s._v(" 取消请求")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 取消所有HTTP请求\n */\n+ (void)cancelAllRequest;\n\n/**\n 取消指定URL的HTTP请求\n */\n+ (void)cancelRequestWithURL:(NSString *)URL;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h4",{attrs:{id:"上传"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上传"}},[s._v("#")]),s._v(" 上传")]),s._v(" "),e("h5",{attrs:{id:"上传文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上传文件"}},[s._v("#")]),s._v(" 上传文件")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 上传文件\n\n @param URL 请求地址\n @param parameters 请求参数\n @param name 文件对应服务器上的字段\n @param filePath 文件本地的沙盒路径\n @param progressBlock 上传进度回调\n @param callback 请求回调\n @return 返回的对象可取消请求,调用cancel方法\n */\n+ (NSURLSessionTask *)uploadFileWithURL:(NSString *)URL\n                             parameters:(NSDictionary *)parameters\n                                   name:(NSString *)name\n                               filePath:(NSString *)filePath\n                          progressBlock:(DKNetworkProgressBlock)progressBlock\n                               callback:(void(^)(DKNetworkResponse *response))callback;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h5",{attrs:{id:"上传图片"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#上传图片"}},[s._v("#")]),s._v(" 上传图片")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 上传图片\n\n @param URL 请求地址\n @param parameters 请求参数\n @param name 图片对应服务器上的字段\n @param images 图片数组\n @param fileNames 图片文件名数组，传入nil时数组内的文件名默认为当前日期时间戳+索引\n @param imageScale 图片文件压缩比 范围 (0.f ~ 1.f)\n @param imageType 图片文件的类型，例:png、jpg(默认类型)....\n @param progressBlock 上传进度回调\n @param callback 请求回调\n @return 返回的对象可取消请求,调用cancel方法\n */\n+ (NSURLSessionTask *)uploadImagesWithURL:(NSString *)URL\n                               parameters:(NSDictionary *)parameters\n                                     name:(NSString *)name\n                                   images:(NSArray<UIImage *> *)images\n                                fileNames:(NSArray<NSString *> *)fileNames\n                               imageScale:(CGFloat)imageScale\n                                imageType:(NSString *)imageType\n                            progressBlock:(DKNetworkProgressBlock)progressBlock\n                                 callback:(void(^)(DKNetworkResponse *response))callback;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("h4",{attrs:{id:"下载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[s._v("#")]),s._v(" 下载")]),s._v(" "),e("div",{staticClass:"language-objc line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n 下载文件\n\n @param URL 请求地址\n @param fileDir 文件存储目录(默认存储目录为Download)\n @param progressBlock 文件下载的进度回调\n @param callback 请求回调，filePath为文件保存路径\n @return 返回 NSURLSessionDownloadTask 实例，可用于暂停继续，暂停调用 suspend 方法，开始下载调用 resume 方法\n */\n+ (NSURLSessionTask *)downloadWithURL:(NSString *)URL\n                              fileDir:(NSString *)fileDir\n                        progressBlock:(DKNetworkProgressBlock)progressBlock\n                             callback:(void(^)(NSString *filePath, NSError *error))callback;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h2",{attrs:{id:"todo"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[s._v("#")]),s._v(" TODO")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("链式编程虽然好看一点，但是没有常规调用方便，不能像以往一样敲两个字母 Xcode 就智能补全整个方法，并且可能会出现 "),e("code",[s._v(".get().post().get().post()")]),s._v(" 这种没有意义的链式调用的情况。")])]),s._v(" "),e("li",[e("p",[s._v("用面向协议（接口）的函数式编程可以解决上面的问题，但是网络层工具的调用是可以没有顺序的，比如 "),e("code",[s._v(".params().post()")]),s._v(" 跟 "),e("code",[s._v(".post().params()")]),s._v(" 应该是都可以的，这样的话会让协议很难制定，还是会出现上面的问题。")])]),s._v(" "),e("li",[e("p",[s._v("日志保存文件")])]),s._v(" "),e("li",[e("p",[s._v("考虑添加 UI 层分类，让网络请求的错误日志以一种更友好的方式展示。")])]),s._v(" "),e("li",[e("p",[s._v("与服务端的通讯加密，考虑添加 RSA 非对称加密等方法。")])])]),s._v(" "),e("h2",{attrs:{id:"后话"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#后话"}},[s._v("#")]),s._v(" 后话")]),s._v(" "),e("p",[s._v("DKNetworking 框架源码已经托管在 "),e("a",{attrs:{href:"https://github.com/bingozb/DKNetworking/",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub"),e("OutboundLink")],1),s._v("，遵循 MIT 协议。欢迎向我们发起 PR 贡献您的代码，或者有什么建议欢迎 Issues。")])])}),[],!1,null,null,null);a.default=r.exports}}]);