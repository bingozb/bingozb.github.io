(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{357:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("程序员调试程序无非就两种，打印日志和断点调试。大部分情况下，这是足够的，但有些特殊情况，比如 iPhone 接着外接设备比如 OTG，这个时候就没办法用数据线连电脑了，自然也就无法断点调试，只能靠日志。而日志也没办法直接显示在 Xcode 上，只能用保存文件的方式将日志文件保存到手机，再去找到日志去看。非常麻烦，于是想了一下用 webSocket 与服务器通讯，就能以一种更直接方便的方式来看日志。")]),s._v(" "),a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("h3",{attrs:{id:"node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js"}},[s._v("#")]),s._v(" Node.JS")]),s._v(" "),a("p",[s._v("到 "),a("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 官网"),a("OutboundLink")],1),s._v(" "),a("strong",[s._v("安装 nodejs 环境")]),s._v("，安装完成后敲"),a("code",[s._v("node -v")]),s._v("，如果 log 输出了版本号，说明 node 环境已经配好了。")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ node "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v\nv4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"socket-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#socket-io"}},[s._v("#")]),s._v(" socket.io")]),s._v(" "),a("p",[s._v("先贴上 "),a("a",{attrs:{href:"https://socket.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Socket.io 官网"),a("OutboundLink")],1),s._v("，"),a("a",{attrs:{href:"https://github.com/socketio/socket.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Socket.io GitHub"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"安装-socket-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-socket-io"}},[s._v("#")]),s._v(" 安装 socket.io")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ sudo npm install "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket.io'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意，要指定版本号为0.9，用1.0以上的1.x版本有问题，因为 Client（iOS）端的 socket.io 是0.9版本，不支持1.x，如果使用0.9版本的客户端给1.x版本的服务端发消息，会出现400报错：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Transport unknown"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("解决办法就是 fall back，卸载重装")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ sudo npm uninstall "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket.io'")]),s._v("\n$ sudo npm install "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket.io'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"app-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-js"}},[s._v("#")]),s._v(" app.js")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" io "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket.io'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sockets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'connection'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("socket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nsocket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'development'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'browser client etag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log level'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'release'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'transports'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'websocket'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("其中 8888 为 node 监听的端口，可根据需求更改。\nlog level 设为 1 是为了不输出 debug 的 log。")]),s._v(" "),a("p",[s._v("保存这个 js 文件并用 node 命令执行，（建议保存到项目目录下，后期可能会做一些自动化脚本来执行。）")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ node app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("js")]),s._v("\ninfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" socket"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("io started\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果看到"),a("code",[s._v("info - socket.io started")]),s._v(" 就说明，服务端已经启动完毕。当然，可能没有那么一帆风顺，可能有几个报错：")]),s._v(" "),a("p",[a("code",[s._v("Error: Cannot find module 'express'")]),s._v(" ： 缺少插件，将 "),a("code",[s._v("express")]),s._v(" 和 "),a("code",[s._v("ejs")]),s._v(" 都安装即可。")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ sudo npm install "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),s._v("\n$ sudo npm install "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ejs'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("warn - error raised: Error: listen EADDRINUSE :::8888")]),s._v(" : 端口占用，要么监听其它端口，要么将端口占用的程序杀掉。")]),s._v(" "),a("p",[s._v("查看 PID")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ sudo lsof "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\nCOMMAND  PID  USER   FD   TYPE             DEVICE SIZE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("OFF NODE NAME\nnode    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1371")]),s._v(" bingo   11u  IPv6 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xdaf792eabddb3d4d")]),s._v("      0t0  TCP "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ddi"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tcp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LISTEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("杀死进程")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ sudo kill "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1371")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再试着执行 nodejs 即可")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("$ node app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("js")]),s._v(" \ninfo  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" socket"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),s._v("io started\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果还有其它问题，自行网上查找资料解决，后面我会考虑将端口占用的问题也用脚本自动化解决。")]),s._v(" "),a("p",[s._v("以上都是准备工作，其实也不多，只需要准备一次环境，以后就不需要再搞服务端了。")]),s._v(" "),a("h2",{attrs:{id:"使用方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[s._v("#")]),s._v(" 使用方法")]),s._v(" "),a("p",[s._v("将源代码中的 "),a("code",[s._v("DKSocketLog")]),s._v(" 文件夹整个添加到 iOS 项目中，并在 PCH 文件中引入头文件")]),s._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#import "DKSocketLog.h"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("项目需要在 Build Phases 添加 "),a("code",[s._v("libicucore.tbd")]),s._v("，否则会报如下错误。")]),s._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Undefined symbols for architecture arm64:\n"_utf8_nextCharSafeBody", referenced from:\n_validate_dispatch_data_partial_string in SRWebSocket.o\nld: symbol(s) not found for architecture arm64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("找一个地方写 DKSocketLog 的配置，可以写在 AppDelegate 或者其它地方，根据项目架构自行安排。Demo 中我新建了一个类 DKLogConfig，并在 load 方法中进行配置。")]),s._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('+ (void)load\n{\n//    [[DKSocketLog sharedInstance] setDebugMode:YES];\n//    [[DKSocketLog sharedInstance] setSecureEnable:YES];\n    [[DKSocketLog sharedInstance] setupHostname:@"192.168.1.89" port:8888];\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[s._v("方法")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("setDebugMode")]),s._v(" "),a("td",[s._v("是否开启DEBUG模式，默认关闭")])]),s._v(" "),a("tr",[a("td",[s._v("setSecureEnable")]),s._v(" "),a("td",[s._v("是否使用安全传输协议（HTTPS）")])]),s._v(" "),a("tr",[a("td",[s._v("setupHostname:port")]),s._v(" "),a("td",[s._v("设置主机名和端口，模拟器可以不设置，默认是 localhost；真机要确保与电脑在同一个网段下，局域网下或使用 WIFI")])])])]),s._v(" "),a("p",[s._v("使用 DKLog(...) 代替 NSLog(...)")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('DKLog(@"打印100内的随机数:%d", arc4random_uniform(100));\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果没问题，就可以看到 Xcode 的控制台与终端同步输出 log")]),s._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("2017-03-02 15:36:40.705 -[ViewController logBtnClick] 第25行: 打印100内的随机数:14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"补充"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[s._v("#")]),s._v(" 补充")]),s._v(" "),a("p",[s._v("或许会有疑问，真实环境下会不会浪费带宽，每次都尝试链接会不会消耗性能？")]),s._v(" "),a("p",[s._v("可以放心，这种 log 只在 DEBUG 包下有效，发布 Release 包什么操作也没有，详情可以看 DKLog 宏的定义。")]),s._v(" "),a("div",{staticClass:"language-objc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#ifdef DEBUG\n#define DKLog(...) \\\nNSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init]; \\\n[dateFormatter setDateFormat:@"yyyy-MM-dd hh:mm:ss.SSS"]; \\\nNSString *dateStr = [dateFormatter stringFromDate:[NSDate date]]; \\\nNSString *logStr = [NSString stringWithFormat:@"%@ %s 第%d行: %@",dateStr, __func__, __LINE__, [NSString stringWithFormat:__VA_ARGS__]]; \\\nprintf("%s\\n", [logStr UTF8String]);\\\n[[DKSocketLog sharedInstance].socketIO sendMessage:logStr];\n#else\n#define DKLog(...)\n#endif\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"后话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后话"}},[s._v("#")]),s._v(" 后话")]),s._v(" "),a("p",[s._v("一个简单的终端监听日志并输出的功能就这样集成实现了，当然还是显得有些简陋，可扩展的功能还有很多，比如很多东西都可以封成一个 Shell 脚本，除了上面说到的执行 node 命令，杀死占用端口的进程外，还可以将日志写到电脑上，在项目根目录下建一个 log 文件夹并将日志都保存到 log 文件夹下，并按日期分文件，好像挺好玩的样子，还有同事说既然都用到了 webSocket，为什么不用网页来展示日志？可以更美观，好像也有道理，这样就不用开着终端了，node 在后台跑着进程就行，再写一个守护进程的保证它不死掉等等，后面有时间慢慢扩展。")])])}),[],!1,null,null,null);t.default=e.exports}}]);