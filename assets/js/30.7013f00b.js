(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{358:function(a,s,t){"use strict";t.r(s);var n=t(4),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),t("p",[a._v("UniversalLink（通用链接），是 Apple 在 WWDC 2015 上为 iOS9 引入的一个新功能，是通过传统 HTTP 链接来启动 App 的技术。可以使用相同的网址打开网站和 App。")]),a._v(" "),t("p",[a._v("通过唯一的网址，如果用户有安装域名绑定的 App，点击就可以打开 App，跳转到具体的界面，不需要特殊的 Schema；如果用户没有安装 App 则点击链接跳到对应的普通网页。")]),a._v(" "),t("h2",{attrs:{id:"依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[a._v("#")]),a._v(" 依赖")]),a._v(" "),t("ul",[t("li",[a._v("Xcode 7 beta 2 以上")]),a._v(" "),t("li",[a._v("iOS 9 beta2 以上")]),a._v(" "),t("li",[a._v("支持 HTTPS 的域名")])]),a._v(" "),t("h2",{attrs:{id:"操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作"}},[a._v("#")]),a._v(" 操作")]),a._v(" "),t("h3",{attrs:{id:"添加域名到-capabilities-associated-domains"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加域名到-capabilities-associated-domains"}},[a._v("#")]),a._v(" 添加域名到 Capabilities -> Associated Domains")]),a._v(" "),t("p",[a._v("在 Xcode 的 Capabilities 里，打开 Associated Domains 开关，并添加需要绑定的域名, 必须用 applinks: 为前缀。可以添加一些子域和扩展（www.domain.com, news.domain.com 等等）。")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/blog/30/AssociatedDomains.png",alt:"Associated Domains"}})]),a._v(" "),t("p",[a._v("如果正常，可以看到项目中会自动添加一个 entitlements 文件。")]),a._v(" "),t("h3",{attrs:{id:"配置-apple-app-site-association-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-apple-app-site-association-文件"}},[a._v("#")]),a._v(" 配置 apple-app-site-association 文件")]),a._v(" "),t("p",[a._v("新建一个文件名，命名为"),t("code",[a._v("apple-app-site-association")]),a._v("，然后编辑内容为一段 Json。")]),a._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"applinks"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"apps"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"details"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"appID"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"4MX4MNJ2AK.cn.dankal.SF"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"paths"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"*"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[a._v("Key")]),a._v(" "),t("th",[a._v("Value")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("apps")]),a._v(" "),t("td",[a._v("必须为空数组")])]),a._v(" "),t("tr",[t("td",[a._v("details")]),a._v(" "),t("td",[a._v("字典数组，每个app对应一个字典")])]),a._v(" "),t("tr",[t("td",[a._v("appID")]),a._v(" "),t("td",[a._v("由前缀和ID两部分组成，可以在 developer.apple.com 中的 Identifiers → AppIDs 中点击对应的 App ID 查看。")])]),a._v(" "),t("tr",[t("td",[a._v("paths")]),a._v(" "),t("td",[a._v("对应域名中的path，用于过滤可以跳转到App的链接，支持通配符‘*’，‘？’以及‘NOT’进行匹配，匹配的优先级是从左至右依次降低。")])])])]),a._v(" "),t("p",[a._v("最后, 把这个文件上传到域名根目录。确保打开 https://domain.com/apple-app-site-association 如果可以看到或下载到该文件。")]),a._v(" "),t("h3",{attrs:{id:"在-app-里处理通用链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-app-里处理通用链接"}},[a._v("#")]),a._v(" 在 APP 里处理通用链接")]),a._v(" "),t("p",[a._v("为了在 APP 里支持通用链接，需要在 AppDelegate 里实现一个方法。")]),a._v(" "),t("div",{staticClass:"language-objc line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity restorationHandler:(void (^)(NSArray * _Nullable))restorationHandler\n{\n    if ([userActivity.activityType isEqualToString:NSUserActivityTypeBrowsingWeb]) {\n        // 打开App后，做某些具体的视图跳转操作\n        // 如果需要获取链接的参数，可以通过userActivity.webpageURL.absoluteString拿到url字符串\n        // 然后再根据规则切割或者截取，获取到想要的参数值\n        // ...\n        return YES;\n    }\n    return NO; // 只打开App\n}\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("h2",{attrs:{id:"通用链接工作流程图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通用链接工作流程图"}},[a._v("#")]),a._v(" 通用链接工作流程图")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/blog/30/webPageURL.png",alt:"工作流程图"}})]),a._v(" "),t("h2",{attrs:{id:"补充"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[a._v("#")]),a._v(" 补充")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("apple-app-site-association 不需要 .json 后缀。")])]),a._v(" "),t("li",[t("p",[a._v("对 json 文件的请求仅在 App 第一次启动时进行，如果此时网络连接出了问题，apple 会缓存请求，等有网的时候再去请求，而实际测试抓包就算网络恢复了也没有请求，所以此时的通用连接会失效。")])]),a._v(" "),t("li",[t("p",[a._v("paths 匹配的优先级是从左至右依次降低，但需要明确，否则会出问题。比如"),t("code",[a._v('"paths":["NOT /together/*","*"]')]),a._v("，在 iOS 9.2 上 path 为 "),t("code",[a._v("/together/*")]),a._v(" 都不会跳到 App，但是在 iOS 9.0 上会跳到 App，这就有问题了。")])]),a._v(" "),t("li",[t("p",[a._v("从 iOS 9.2 开始，在相同的 domain 内 Universal Links 是不起作用的，必须要跨域才能生效。")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);