---
title: iOS10.2 非完美越狱
date: 2017-02-19 21:19:49
categories: 战斗笔记
tags: [iOS, 安全攻防]
---

## 前言

为了越狱，真是操碎了心。不过，这确实是一段有意义的回忆，若干年后，当 iPhone 出到十几代的时候，回头再来看看，肯定会很有感触。

<!-- more -->

## 回想当年

我上一次玩越狱大概是在2012年，那时候 iPhone 4s 刚刚面世，我就买了一部。对于一个高中生，3750元简直是天价。真果粉的我，靠玩游戏赚钱，每天大概一小时收入20块，（每天也就一小时），积累了数月后，带着3700元去到手机店，差50元是跟我爸借的。

从那一刻开始，我就定下了人生的一个原则：作为一个真果粉，苹果可以买买买，但要靠自己，不能向家里人要钱。 我现在已经拥有六件苹果设备，无一例外都遵循这个原则。

那时候我身边的朋友们大部分是买 iPhone 4，iOS 系统是 5.0 左右的版本，有些朋友特别喜欢 iOS 5.5。我买 4s 的时候内置了 6.1.0，后来我升到了 6.1.2，是 iOS 6 系列最后一个能越狱的版本。我记得我姐后来也买了一部，那时候出厂已经是 6.1.3，不能越狱了。

想当年，改主题、改状态栏，把运营商如“中国移动”改为自定义的文字，图案等，电池显示样式也可以随机改、改锁屏页，充电时候屏幕中间的绿色电池可以改成其他样式，“滑动来解锁”的字可以改得闪闪发光，可以在中文语言状态下把这些字改成自定义的英文，向右滑动解锁可以改成向上；各种插件，自定义手势，屏幕左划一下打开QQ，屏幕右划一下打开电话，屏幕上划打开后台管理等等。那时候玩越狱，完全就可以把 iPhone 当安卓来玩，完全自定义，没有办不到的事。

当初越狱最早的初衷只是为了一个九宫格输入法，相信很多人都跟我一样。进了门之后才发现是一个新世界，自由的世界，甚至天堂。不需要 Apple ID，应用可以随便下，App Store 里面收费的应用或者游戏都可以免费下。那时候，大部分人买手机就会选择越狱，那以及是主流用户习惯。后来，iOS 7 出来的时候，自带的输入法已经支持九宫格了，这让一大波越狱用户“改邪归正”，“越狱还有什么用”之类的党派之争也随之而来，当然，对这种事情我们当然是保留自己的看法就好。所以，我坚持不升级，一直到 iPhone 6 出现，带来了 iOS 9 系列。从未体验过 iOS 7 的我，跳过了 iOS 7 和 iOS 8，直接把我的 iPhone 4s 升级到了 iOS 9.0。

那时的我，是多么固执！越过了两个大版本的系统，坚持不升级。某一天，心血来潮，在监狱外面呆久了，突然想回到牢里去，于是我就升级了。就是这么一升，回不去了！苹果关闭了低版本的固件验证，再也刷不回低版本了，我的 iOS 6 啊！那可是最流畅的系统版本，没有之一。看那夕阳下的奔跑，那是我逝去的青春~

所以，最终的结局就是我的4s变得卡得要命，刷不回去，废了。次年9月苹果发布 iPhone 6s，我在双十一用奖学金买了一部 iPhone 6s plus，64G 土豪金，当时官网价格是 7188，趁着双十一活动 6588 拿下了它。

## 现在

为什么要说上面的经历呢，除了留作我个人回忆，还有就是因为那个时候越狱玩的东西，跟我现在要做的事情息息相关。也正是那时候玩过，现在的理解才会跟别人有差异。现在大部分人都不懂越狱是什么东西，只有一个模糊的概念，毕竟近些年已经渐渐没听到这个词了。

其实，越狱，简单地讲，就是 iOS 系统被黑了，被破解了。

高手在民间，从太极到盘古，再到如今的卢卡斯，都在打苹果的脸。连苹果自己都无法阻止被黑，那么上架到 app Store 上面的 app 就一定安全吗？我看不见得吧，即便苹果帮我们的 ipa 穿上了一层战衣，但还是挡不住有心人。敲壳、反编译等等逆向工程的我会慢慢写文章来记录。

先要知道如何攻击，才能知道如何防守。而这一切，都跟越狱有关，比如许多操作需要越狱设备开启 SSH 通道，电脑连上越狱设备后通过终端命令行运行objc代码等等。那么就将越狱作为安全攻防的开端吧。

废话不多说，马上开始越狱吧。

## 越狱

#### 下载安装越狱工具

- Cydia Impactor
    - [Cydia Impactor for Mac](https://cdn.bingo.ren/app/impactor_0.9.38.dmg)
    - [Cydia Impactor for Windows](https://cdn.bingo.ren/app/Impactor_0.9.38.zip)
- [yalu102_beta7.ipa](https://cdn.bingo.ren/app/yalu102_beta7.ipa)

#### 加载 ipa

以 mac 为例，手机连上电脑后，软件会读取到手机信息，把 yalu102_beta7.ipa 拖入软件中。

![impactor](https://cdn.bingo.ren/impactor/impactor.png)

#### 输入 Apple ID 和 密码

输入 apple ID，然后输入密码

![password](https://cdn.bingo.ren/impactor/password.png)

注意，这个密码可以是 Apple ID 的密码，但不能开启双重验证，否则会报错。

![error](https://cdn.bingo.ren/impactor/error.png)

如果不想关闭双重验证，为了安全着想确实不应该关闭，那么可以去 [苹果ID官网](https://appleid.apple.com/account/manage) 安全 那里申请 App 专用密码。

![appleid_appPwd](https://cdn.bingo.ren/impactor/appleid_password.png)

然后重新按照前面的步骤，到输入密码那一步的时候，输入刚刚生成的密码，注意大小写。

接着会出现一个警告，如果看到这个警告基本就没什么问题了。

![warning](https://cdn.bingo.ren/impactor/warning.png)

警告的意思是，接下来会废除并替换掉这个账号所有的证书，也就是以前的证书会全部失效，最直接的结果就是原本 iCloud 登录了这个账号，会被要求重新输入密码重新登录。其它的证书暂时没发现有什么影响。

#### 安装成功

点击 OK 后，就会一直自动执行到安装 ipa 成功。其中包括了用刚刚输入的 Apple ID 对 ipa 进行签名，有效期为7天。然后安装 ipa 到所连接的手机中，最后看到 complete 的时候就安装完成了。这个时候看手机，可以看到有一个 app 名字为 yalu102，icon 是灰色的金三胖。

#### 授权验证

这个时候还不能打开，需要先信任开发者。点击设置 - 通用 - 设备管理，就可以看到开发者应用下面有一个刚刚输入的 Apple ID，点击进入详情界面，再点击验证即可。

#### 开始越狱

验证成功后，打开 yalu102，点击屏幕中的 go，即可开始越狱。完成的时候会自动重启，重启后 Cydia 就出来了，越狱完成。

#### 完成越狱

由于操作都很简单，直接截最终的效果：

<img src="https://cdn.bingo.ren/impactor/home.png" width=300>&nbsp;
<img src="https://cdn.bingo.ren/impactor/cydia.png" width=300>

## 补充

越狱后需要安装一个补丁，否则无法访问系统文件，如果你没有这个需求，那我就很好奇你干嘛要越狱了。

cydia 之父发布了支持 iOS 7.1.2 系统的 Afc 补丁，取名为“Apple File Conduit "2" ”，与 afc2add 服务补丁功能一样，都是为了解决 iOS 7.x 越狱后无法访问系统文件（越狱）的问题，大家可以直接在PP助手源上上安装最新的 Afc 补丁

#### 打补丁前的文件系统

电脑上选择一款管理软件，比如PP助手、iTools等。我选择 iTools，因为我的虚拟机打开PP助手的时候总是提示我的文档的权限有问题，可能是跟虚拟机 Parallels Desktop 不兼容吧。

先看看安装补丁前的文件目录，文件系统下面只有用户系统。

![iTools](https://cdn.bingo.ren/impactor/iTools.png)

#### 开始打补丁

首先打开手机上的 Cydia，选择底部的软件源，点击右上角的编辑，然后添加PP助手源。

<img src="https://cdn.bingo.ren/impactor/cydia1.png" width=300>&nbsp;
<img src="https://cdn.bingo.ren/impactor/cydia2.png" width=300>

添加完毕后在软件源中找到“PP助手源”，选择“全部软件包”，然后选择 Apple File Conduit "2" 。

<img src="https://cdn.bingo.ren/impactor/cydia3.png" width=300>&nbsp;
<img src="https://cdn.bingo.ren/impactor/cydia4.png" width=300>

点击进入详情，并点击右上角的安装即可完成。

<img src="https://cdn.bingo.ren/impactor/cydia5.png" width=300>&nbsp;
<img src="https://cdn.bingo.ren/impactor/cydia6.png" width=300>

#### 打补丁后的文件系统

最后重新打开iTools，看看打完补丁的文件系统，就可以看到越狱系统了。

![iTools](https://cdn.bingo.ren/impactor/iTools1.png)

## 后话

至此，一部64位的iPhone，iOS 10.2 就越狱成功了，也可以访问到系统文件了。但是，正如标题所说，这是非完美越狱。也就是说，重启手机后，打开 Cydia 就闪退了，需要打开 yalu102 重新越狱。不过还好，过程还是挺快的。

#### 参考

[[教程] 【ios10.2越狱教程】已更新最新越狱IPA，附免除7天重签方法]([教程] 【ios10.2越狱教程】已更新最新越狱IPA，附免除7天重签方法)

[Apple File Conduit"2"补丁安装教程](http://bbs.25pp.com/thread-225764-1-1.html)