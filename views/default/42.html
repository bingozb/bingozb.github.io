<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker 构建测试环境 | Bingo&#39;s Blog</title>
    <meta name="description" content="Stay Hungry, Stay Foolish.">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.85941b03.css" as="style"><link rel="preload" href="/assets/js/app.2cce0900.js" as="script"><link rel="preload" href="/assets/js/3.89e13237.js" as="script"><link rel="preload" href="/assets/js/1.70547aa9.js" as="script"><link rel="preload" href="/assets/js/43.b97d0a10.js" as="script"><link rel="prefetch" href="/assets/js/10.3c6fb3a5.js"><link rel="prefetch" href="/assets/js/11.2eeb7c65.js"><link rel="prefetch" href="/assets/js/12.0a44cf1b.js"><link rel="prefetch" href="/assets/js/13.095a9818.js"><link rel="prefetch" href="/assets/js/14.1be11406.js"><link rel="prefetch" href="/assets/js/15.e554eb44.js"><link rel="prefetch" href="/assets/js/16.f1414a6c.js"><link rel="prefetch" href="/assets/js/17.b52602a0.js"><link rel="prefetch" href="/assets/js/18.8b7f3781.js"><link rel="prefetch" href="/assets/js/19.b7ae4aee.js"><link rel="prefetch" href="/assets/js/20.b6853c64.js"><link rel="prefetch" href="/assets/js/21.e073a224.js"><link rel="prefetch" href="/assets/js/22.acdd8a05.js"><link rel="prefetch" href="/assets/js/23.1c12c2b0.js"><link rel="prefetch" href="/assets/js/24.54454a6e.js"><link rel="prefetch" href="/assets/js/25.d2758f74.js"><link rel="prefetch" href="/assets/js/26.d5a0d37c.js"><link rel="prefetch" href="/assets/js/27.c37293c1.js"><link rel="prefetch" href="/assets/js/28.9aa6999f.js"><link rel="prefetch" href="/assets/js/29.3f834fad.js"><link rel="prefetch" href="/assets/js/30.204f54c2.js"><link rel="prefetch" href="/assets/js/31.6ec21ed3.js"><link rel="prefetch" href="/assets/js/32.d9f1eaad.js"><link rel="prefetch" href="/assets/js/33.9f77db73.js"><link rel="prefetch" href="/assets/js/34.8d98d620.js"><link rel="prefetch" href="/assets/js/35.c079886a.js"><link rel="prefetch" href="/assets/js/36.a7753580.js"><link rel="prefetch" href="/assets/js/37.768cbc39.js"><link rel="prefetch" href="/assets/js/38.7518e87e.js"><link rel="prefetch" href="/assets/js/39.08815020.js"><link rel="prefetch" href="/assets/js/4.fef5f850.js"><link rel="prefetch" href="/assets/js/40.3c730d54.js"><link rel="prefetch" href="/assets/js/41.78182697.js"><link rel="prefetch" href="/assets/js/42.0c37e550.js"><link rel="prefetch" href="/assets/js/44.7084cae0.js"><link rel="prefetch" href="/assets/js/45.027d8c45.js"><link rel="prefetch" href="/assets/js/46.ce8ceaa3.js"><link rel="prefetch" href="/assets/js/47.0b768238.js"><link rel="prefetch" href="/assets/js/48.0a9f5884.js"><link rel="prefetch" href="/assets/js/49.b93994f6.js"><link rel="prefetch" href="/assets/js/5.5714c074.js"><link rel="prefetch" href="/assets/js/50.2a6c399e.js"><link rel="prefetch" href="/assets/js/51.a2170a2a.js"><link rel="prefetch" href="/assets/js/52.f23fb563.js"><link rel="prefetch" href="/assets/js/53.5caf7ce2.js"><link rel="prefetch" href="/assets/js/54.26b44e31.js"><link rel="prefetch" href="/assets/js/55.e69a03f2.js"><link rel="prefetch" href="/assets/js/56.b8b24303.js"><link rel="prefetch" href="/assets/js/57.5040680b.js"><link rel="prefetch" href="/assets/js/58.f8adcb83.js"><link rel="prefetch" href="/assets/js/59.39b813e1.js"><link rel="prefetch" href="/assets/js/6.66b43321.js"><link rel="prefetch" href="/assets/js/60.28356680.js"><link rel="prefetch" href="/assets/js/61.bad972f7.js"><link rel="prefetch" href="/assets/js/62.9332576a.js"><link rel="prefetch" href="/assets/js/63.31d32cc8.js"><link rel="prefetch" href="/assets/js/64.07da8063.js"><link rel="prefetch" href="/assets/js/65.9b949ed1.js"><link rel="prefetch" href="/assets/js/66.889a2499.js"><link rel="prefetch" href="/assets/js/67.bc7345f3.js"><link rel="prefetch" href="/assets/js/68.cac4f0d4.js"><link rel="prefetch" href="/assets/js/7.18d02750.js"><link rel="prefetch" href="/assets/js/8.14d68426.js"><link rel="prefetch" href="/assets/js/9.56ff9bf1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.85941b03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-21b9510f><div data-v-21b9510f><div id="loader-wrapper" class="loading-wrapper" data-v-71fac282 data-v-21b9510f data-v-21b9510f><div class="loader-main" data-v-71fac282><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div><div data-v-71fac282></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cb76055 data-v-21b9510f data-v-21b9510f><h3 class="title" style="display:none;" data-v-6cb76055 data-v-6cb76055>Bingo's Blog</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cb76055 data-v-6cb76055><input type="password" value="" data-v-6cb76055> <span data-v-6cb76055>Konck! Knock!</span> <button data-v-6cb76055>OK</button></label> <div class="footer" style="display:none;" data-v-6cb76055 data-v-6cb76055><span data-v-6cb76055><i class="iconfont reco-theme" data-v-6cb76055></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cb76055>vuePress-theme-reco</a></span> <span data-v-6cb76055><i class="iconfont reco-copyright" data-v-6cb76055></i> <a data-v-6cb76055><span data-v-6cb76055>Bingo</span>
            
          <span data-v-6cb76055>2016 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-21b9510f><header class="navbar" data-v-21b9510f><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Bingo's Blog" class="logo"> <span class="site-name">Bingo's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/解决方案/" class="nav-link"><i class="iconfont undefined"></i>
  解决方案
</a></li><li class="dropdown-item"><!----> <a href="/categories/战斗笔记/" class="nav-link"><i class="iconfont undefined"></i>
  战斗笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/DKKIT/" class="nav-link"><i class="iconfont undefined"></i>
  DKKIT
</a></li><li class="dropdown-item"><!----> <a href="/categories/工作总结/" class="nav-link"><i class="iconfont undefined"></i>
  工作总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/about/index.html" class="nav-link"><i class="iconfont reco-message"></i>
  About me
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/bingozb" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-21b9510f></div> <aside class="sidebar" data-v-21b9510f><div class="personal-info-wrapper" data-v-77ccc048><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-77ccc048> <h3 class="name" data-v-77ccc048>
    Bingo
  </h3> <div class="num" data-v-77ccc048><div data-v-77ccc048><h3 data-v-77ccc048>56</h3> <h6 data-v-77ccc048>Article</h6></div> <div data-v-77ccc048><h3 data-v-77ccc048>26</h3> <h6 data-v-77ccc048>Tag</h6></div></div> <hr data-v-77ccc048></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/解决方案/" class="nav-link"><i class="iconfont undefined"></i>
  解决方案
</a></li><li class="dropdown-item"><!----> <a href="/categories/战斗笔记/" class="nav-link"><i class="iconfont undefined"></i>
  战斗笔记
</a></li><li class="dropdown-item"><!----> <a href="/categories/DKKIT/" class="nav-link"><i class="iconfont undefined"></i>
  DKKIT
</a></li><li class="dropdown-item"><!----> <a href="/categories/工作总结/" class="nav-link"><i class="iconfont undefined"></i>
  工作总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/about/index.html" class="nav-link"><i class="iconfont reco-message"></i>
  About me
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/bingozb" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker 构建测试环境</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/default/42.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/default/42.html#为什么需要测试环境？" class="sidebar-link">为什么需要测试环境？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/default/42.html#docker-入门" class="sidebar-link">Docker 入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/default/42.html#什么是-docker-？" class="sidebar-link">什么是 Docker ？</a></li><li class="sidebar-sub-header"><a href="/views/default/42.html#docker-的安装" class="sidebar-link">Docker 的安装</a></li><li class="sidebar-sub-header"><a href="/views/default/42.html#docker-的使用" class="sidebar-link">Docker 的使用</a></li><li class="sidebar-sub-header"><a href="/views/default/42.html#项目部署" class="sidebar-link">项目部署</a></li></ul></li><li><a href="/views/default/42.html#补充" class="sidebar-link">补充</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/default/42.html#todo" class="sidebar-link">TODO</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cb76055 data-v-21b9510f><h3 class="title" style="display:none;" data-v-6cb76055 data-v-6cb76055>Docker 构建测试环境</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cb76055 data-v-6cb76055><input type="password" value="" data-v-6cb76055> <span data-v-6cb76055>Konck! Knock!</span> <button data-v-6cb76055>OK</button></label> <div class="footer" style="display:none;" data-v-6cb76055 data-v-6cb76055><span data-v-6cb76055><i class="iconfont reco-theme" data-v-6cb76055></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cb76055>vuePress-theme-reco</a></span> <span data-v-6cb76055><i class="iconfont reco-copyright" data-v-6cb76055></i> <a data-v-6cb76055><span data-v-6cb76055>Bingo</span>
            
          <span data-v-6cb76055>2016 - </span>
          2020
        </a></span></div></div> <div data-v-21b9510f><main class="page"><div class="page-title" style="display:none;"><h1>Docker 构建测试环境</h1> <hr> <div data-v-c4ddd85a><i class="iconfont reco-account" data-v-c4ddd85a><span data-v-c4ddd85a>Bingo</span></i> <i class="iconfont reco-date" data-v-c4ddd85a><span data-v-c4ddd85a>2017-07-14 01:26:51</span></i> <!----> <i class="iconfont reco-tag tags" data-v-c4ddd85a><span class="tag-item" data-v-c4ddd85a>
      L
    </span><span class="tag-item" data-v-c4ddd85a>
      i
    </span><span class="tag-item" data-v-c4ddd85a>
      n
    </span><span class="tag-item" data-v-c4ddd85a>
      u
    </span><span class="tag-item" data-v-c4ddd85a>
      x
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p><img src="/images/blog/42/logo-docker.jpg" alt="Docker"></p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>这阵子一直在忙项目，已经有一个多月没有写博客了，有很多关于运维、JavaEE、甚至心灵鸡汤和想法等的东西，想总结写成文章归档却一直都没有时间，写这篇博客也是在大半夜。但是必须要写，因为公司急需一套构建测试环境的机制。</p> <p>以前觉得项目部署的环境应该有两个，即开发环境和正式环境。但经历了顺丰专送这个项目之后，才明白真的错了，还需要一个测试环境，而 Docker 正是“复制环境”的利器。</p> <h2 id="为什么需要测试环境？"><a href="#为什么需要测试环境？" class="header-anchor">#</a> 为什么需要测试环境？</h2> <p>有这么一个真实画面：我们的测试人员在测试一个小程序的界面，点进去的时候界面一直在 loading，没有数据展现。OK，把这个 BUG 记录下来。过了半分钟，再点进这个界面，正常了，数据出来了。What the ...</p> <p>这个是 BUG 吗？再多试几遍，依然都没有问题。问了一下后端的开发人员，得到结果 ”刚修复了这个BUG“，于是默默把刚记下来的 BUG 划掉 ...</p> <p>以此循环，一直在复测，拼命回归测试，就怕记下来的 BUG 不知不觉又被修复了，所以一天下来几乎什么都没有测出来。</p> <p>所以我们需要测试环境，保证 QA 测试的时候是稳定的。</p> <h2 id="docker-入门"><a href="#docker-入门" class="header-anchor">#</a> Docker 入门</h2> <p>Docker 为开发人员和系统管理员提供了一个可供开发，分发（ship）和运行应用的平台。将 docker 化的应用及其依赖环境不需要经过任何修改就可以分发到任何地方，比如提供给 QA 团队或者分发到云平台中。这是使用 Docker 的一个很重要的目的。</p> <h3 id="什么是-docker-？"><a href="#什么是-docker-？" class="header-anchor">#</a> 什么是 Docker ？</h3> <p><a href="https://www.docker.io/" target="_blank" rel="noopener noreferrer">Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的英文本意是码头工人，也就是搬运工，
它提供了一个可以运行你的应用程序的封套（envelope），或者说容器。它原本是 dotCloud 启动的一个业余项目，后来遵从 Apache 2.0 协议开源了，吸引了大量的关注和讨论，再后来 dotCloud 把它重命名为 Docker Inc。它最初是用 Go 语言编写的，它就相当于是加在 LXC（LinuX Containers，linux 容器）上的管道，允许开发者在更高层次的概念上工作。</p> <p><img src="images/blog/42/docker.png" alt="Docker"></p> <p>Docker 扩展了 Linux 容器（Linux Containers），或着说 LXC，通过一个高层次的 API 为进程单独提供了一个轻量级的虚拟环境。Docker 利用了 LXC， cgroups 和 Linux 自己的内核。和传统的虚拟机不同的是，一个 Docker 容器并不包含一个单独的操作系统，而是基于已有的基础设施中操作系统提供的功能来运行的。</p> <p><img src="images/blog/42/VMs.jpg" alt="Containers vs VMs"></p> <p>容器使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app），更重要的是容器性能开销极低。</p> <p>简单来说，Docker 使软件的传播更加简单，简单从两个方面体现，一是更容易建立，二是共享包含你应用环境配置信息的镜像，应用环境配置也叫做应用操作系统。</p> <h4 id="应用操作系统是什么？"><a href="#应用操作系统是什么？" class="header-anchor">#</a> 应用操作系统是什么？</h4> <p>一般来说，应用程序需要一个特定版本的操作系统，应用服务器，JDK，数据库服务器，还可能需要整合配置文件和其他各种各样的依赖。应用可能需要绑定特定的端口和特定大小的内存。这些运行应用所必须的组件和配置就是所谓的应用操作系统。</p> <p><img src="images/blog/42/docker-app-os.png" alt="Docker"></p> <p>当然，可以写一个安装脚本，在脚本中完成下载并安装这些组件的功能。Docker 能够简化这个过程，简化部署多种应用实例工作，比如 Web 应用、后台应用、数据库应用、大数据应用比如 Hadoop 集群、消息队列等等都可以打包成一个 Image（镜像文件）部署。</p> <p>这些镜像可以被用来创建 Docker containers（容器），容器运行在容器虚拟化平台之上，这个平台由 Docker 提供。</p> <h4 id="docker-与-lxc-的区别"><a href="#docker-与-lxc-的区别" class="header-anchor">#</a> Docker 与 LXC 的区别</h4> <p>这里有一个 <a href="https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools" target="_blank" rel="noopener noreferrer">Stackoverflow 的答案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，里面非常详细清晰地描述了所有 Docker 不同于纯粹的 LXC 的功能特性，简单翻译下就是以下几点：</p> <ul><li><p>Docker 提供了一种可移植的配置标准化机制，允许你一致性地在不同的机器上运行同一个 Container。而 LXC 本身可能因为不同机器的不同配置而无法方便地移植运行。</p></li> <li><p>Docker 以 App 为中心，为应用的部署做了很多优化。而 LXC 的帮助脚本主要是聚焦于如何机器启动地更快和耗更少的内存。</p></li> <li><p>Docker 为 App 提供了一种自动化构建机制（Dockerfile），包括打包，基础设施依赖管理和安装等等。</p></li> <li><p>Docker 提供了一种类似 git 的 Container 版本化的机制，允许你对你创建过的容器进行版本管理，依靠这种机制，你还可以下载别人创建的 Container，甚至像 git 那样进行合并。</p></li> <li><p>Docker Container 是可重用的，依赖于版本化机制，你很容易重用别人的 Container（Image），作为基础版本进行扩展。</p></li> <li><p>Docker Container 是可共享的，有点类似 GitHub 一样，Docker 有自己的 INDEX，你可以创建自己的 Docker 用户并上传和下载 Docker Image。</p></li> <li><p>Docker 提供了很多的工具链，形成了一个生态系统。这些工具的目标是自动化、个性化和集成化，包括对 PAAS 平台的支持等。</p></li></ul> <p>Docker 会像一个可移植的容器引擎那样工作。它把应用程序及所有程序的依赖环境打包到一个虚拟容器中，这个虚拟容器可以运行在任何一种 Linux 服务器上。这大大地提高了程序运行的灵活性和可移植性，无论需不需要许可、是在公共云还是私密云、是不是裸机环境等等。</p> <h4 id="docker-的主要组件是什么？"><a href="#docker-的主要组件是什么？" class="header-anchor">#</a> Docker 的主要组件是什么？</h4> <p>Docker 有两个主要组件：</p> <ul><li><a href="https://www.docker.io/" target="_blank" rel="noopener noreferrer">Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：开源的容器虚拟化平台</li> <li><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：共享和管理 Docker 镜像的 Saas 平台</li></ul> <p>Docker 采用 <a href="https://linuxcontainers.org/" target="_blank" rel="noopener noreferrer">Linux Containers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来提供隔离、沙箱、复制、资源限制、快照和其他的一些优势。参考资料： <a href="https://www.infoq.com/articles/docker-containers" target="_blank" rel="noopener noreferrer">《Docker: Using Linux Containers to Support Portable Application Deployment》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>镜像是 Docker 的构建组件，是一个只读的应用操作系统模板。</p> <p>容器是从镜像创建出来的运行状态，是 Docker 的运行组件。容器是可以运行、启动、停止、移动和删除的。</p> <p>镜像保存的仓库是 Docker 的分发组件，可以选择公开的 Docker Hub（国外的，超级慢），也可以选择搭建私有的 Registry。</p> <h4 id="docker-是怎么工作的？"><a href="#docker-是怎么工作的？" class="header-anchor">#</a> Docker 是怎么工作的？</h4> <p>Docker 按启动顺序包含两个部分：</p> <ul><li>Daemon（服务端）：运行在 host machine（宿主机） 上，承担创建、运行和分发 Docker 容器等重要工作。</li> <li>Client（客户端）：Docker 二进制程序，负责接收用户的命令以及和服务端进行通信。</li></ul> <p>客户端可以和服务端运行在一台主机上，也可以在不同的主机上。</p> <p>服务端需要用 pull 命令从仓库中拉一个镜像下来。服务端可以从 Docker Hub 或者其他配置的仓库中下载镜像。服务端主机可以从仓库中下载和安装多个镜像。</p> <p>客户端用 run 命令 来启动容器。客户端与服务端通过 socket 或者 REST API 进行通信。</p> <p><img src="images/blog/42/docker-architecture-techtip.png" alt="Docker Architecture Techtip"></p> <h3 id="docker-的安装"><a href="#docker-的安装" class="header-anchor">#</a> Docker 的安装</h3> <p>在 CentOS 中安装 Docker:</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo yum <span class="token operator">-</span><span class="token keyword">y</span> install docker<span class="token operator">-</span>io #安装docker
$ sudo service docker start     #启动docker服务
$ sudo chkconfig docker <span class="token keyword">on</span>      #设置docker服务为自启动
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在 Ubuntu/Debian 中安装 Docker:</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo apt<span class="token operator">-</span>get udpate
$ sudo apt<span class="token operator">-</span>get install docker<span class="token operator">.</span>io
$ sudo <span class="token keyword">ln</span> <span class="token operator">-</span><span class="token keyword">sf</span> <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>docker<span class="token operator">.</span>io <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>docker
$ sudo sed <span class="token operator">-</span>i <span class="token string">'$acomplete -F _docker docker'</span> <span class="token operator">/</span>etc<span class="token operator">/</span>bash_completion<span class="token operator">.</span><span class="token keyword">d</span><span class="token operator">/</span>docker<span class="token operator">.</span>io  #命令自动补全
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>其它操作系统的安装可以查看<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="docker-的使用"><a href="#docker-的使用" class="header-anchor">#</a> Docker 的使用</h3> <h4 id="下载镜像"><a href="#下载镜像" class="header-anchor">#</a> 下载镜像</h4> <p>在了解了 Image 和 Container 的概念后，我们可以开始下载一个 Image，Docker 的好处就是提供了一个类似github 的 Image 仓库管理，可以非常方便 pull 别人的 Image 下来运行。</p> <p>例如，我们可以下载一个 CentOS Image：</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo docker pull centos<span class="token punctuation">:</span>centos6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里 centos6是一个 tag，类似于 Git 的 tag，可以通过它来确定下载的 CentOS 的版本。下载完成后，执行 <code>docker images</code> 命令来列出你已经下载的 images：</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token punctuation">[</span>root@BingoECS ~<span class="token punctuation">]</span># docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
docker<span class="token operator">.</span>io<span class="token operator">/</span>centos       centos6             3e32556ae4ba        <span class="token number">7</span> days ago          <span class="token number">194.3</span> MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="运行容器"><a href="#运行容器" class="header-anchor">#</a> 运行容器</h4> <p>我们通过命令行来运行一个容器，命令很简单，例如我们想执行一个 shell 终端：</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo docker run <span class="token operator">-</span>i <span class="token operator">-</span><span class="token keyword">t</span> centos<span class="token punctuation">:</span>centos6 <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认情况下，docker 容器是不提供交互 shell 的，也不提供标准输入。可以指定 <code>-i</code> 选项来提供交互，指定 <code>-t</code> 选项来分配一个伪终端。</p> <p>在 Shell 中你可以做你想做的任意操作，安装软件，编写程序，运行命令等。</p> <p>参考我之前写的，<a href="https://blog.bingo.ren/28.html" target="_blank" rel="noopener noreferrer">《Centos 6 x86 minimal 部署》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，推荐使用 Oneinstack 脚本，10分钟左右自动搭建一套服务端环境。</p> <h4 id="退出容器"><a href="#退出容器" class="header-anchor">#</a> 退出容器</h4> <p>最直接的退出命令 <code>exit</code>、<code>ctrl+c</code>，会使容器停止。</p> <p>如果想要只退出容器的终端，但不停止容器，可以使用组合快捷键：</p> <p>先按 <code>ctrl+p</code>，再按 <code>ctrl+q</code>。</p> <h4 id="进入运行中的容器"><a href="#进入运行中的容器" class="header-anchor">#</a> 进入运行中的容器</h4> <h5 id="docker-attach"><a href="#docker-attach" class="header-anchor">#</a> docker attach</h5> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ docker attach <span class="token operator">-</span>it web <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>bash
$ Enter回车
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：使用 <code>attach</code> 进入后台运行中的容器后，如果退出容器终端使用了 <code>exit</code>，则会导致容器的停止。如果想容器不停止，则需要使用 <code>ctrl+p</code>，再按 <code>ctrl+q</code> 的组合快捷键。</p> <h5 id="docker-exec"><a href="#docker-exec" class="header-anchor">#</a> docker exec</h5> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ docker exec <span class="token operator">-</span>it web <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>相对比 <code>attach</code>，使用 <code>exec</code> 进入容器后，再使用 <code>exit</code> 退出容器终端，不会导致容器的停止。</p> <p>注意：使用 <code>exec</code> 执行后，会命令执行返回值。如果命令需要长时间执行，而不使用 <code>-d</code>，执行 <code>exec</code> 后会卡住，一直等命令执行完成。</p> <h4 id="停止容器"><a href="#停止容器" class="header-anchor">#</a> 停止容器</h4> <h5 id="stop"><a href="#stop" class="header-anchor">#</a> stop</h5> <p>使用 <code>stop</code> 停止容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker stop xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="kill"><a href="#kill" class="header-anchor">#</a> kill</h5> <p>也可以使用 <code>kill</code> 杀掉一个运行中的容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker kill xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="删除容器"><a href="#删除容器" class="header-anchor">#</a> 删除容器</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker rm [OPTIONS] CONTAINER [CONTAINER...]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>OPTIONS 说明：</p> <ul><li><code>-f</code> : 通过 SIGKILL 信号强制删除一个运行中的容器</li> <li><code>-l</code> : 移除容器间的网络连接，而非容器本身</li> <li><code>-v</code> : -v 删除与容器关联的卷</li></ul> <h4 id="保存镜像"><a href="#保存镜像" class="header-anchor">#</a> 保存镜像</h4> <p>在容器里搭建完环境后，想要保存作为新的镜像，先退出容器的终端，然后执行 <code>ps</code> 命令查看容器 ID</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token punctuation">[</span>root@BingoECS ~<span class="token punctuation">]</span># docker <span class="token keyword">ps</span> <span class="token operator">-</span>a
CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS            PORTS             NAMES
d4385272c36a        d453                <span class="token string">&quot;/bin/bash&quot;</span>         <span class="token number">36</span> hours ago        Up <span class="token number">36</span> hours                             web
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后用 <code>commit</code> 命令将 Container 提交成 Image</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo docker commit d4385272c36a dankal<span class="token operator">/</span>sftc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>容器提交后，执行 <code>docker images</code> 就可以看到刚才提交的容器</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code><span class="token punctuation">[</span>root@BingoECS ~<span class="token punctuation">]</span># docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
dankal<span class="token operator">/</span>sftc         latest              fbd8e8ab66fe        <span class="token number">34</span> hours ago        <span class="token number">5.754</span> GB
centos              centos6             7068d4aee850        <span class="token number">7</span> days ago          <span class="token number">194.3</span> MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以后就可以很方便地 <code>run dankal/sftc</code> 创建相同环境的容器，不需要再手动搭建环境了。</p> <h4 id="docker-端口映射"><a href="#docker-端口映射" class="header-anchor">#</a> Docker 端口映射</h4> <p>我们在宿主机已经构建完容器，但我们没办法在外网直接访问到容器。这时候需要做端口映射，通过访问宿主机来转发到容器。</p> <h5 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h5> <p>依然参考我之前写的，<a href="https://blog.bingo.ren/28.html" target="_blank" rel="noopener noreferrer">《Centos 6 x86 minimal 部署》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，修改 iptables，开放几个端口如6666、8888等，然后创建虚拟主机，绑定域名。最后修改 nginx -&gt; conf -&gt; vhost 下，修改对应域名的配置文件。</p> <p>把默认生成的 location 匹配都注释掉：</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code> # location ~ <span class="token operator">.</span><span class="token operator">*</span>\<span class="token operator">.</span><span class="token punctuation">(</span>gif|jpg|jpeg|png|bmp|<span class="token builtin">swf</span>|flv|mp4|ico<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
 #   expires 30d<span class="token punctuation">;</span>
 #   access_log off<span class="token punctuation">;</span>
 # <span class="token punctuation">}</span>
 # location ~ <span class="token operator">.</span><span class="token operator">*</span>\<span class="token operator">.</span><span class="token punctuation">(</span><span class="token builtin">js</span>|css<span class="token punctuation">)</span><span class="token operator">?</span>$ <span class="token punctuation">{</span>
 #   expires 7d<span class="token punctuation">;</span>
 #   access_log off<span class="token punctuation">;</span>
 # <span class="token punctuation">}</span>
 # location ~ <span class="token operator">/</span>\<span class="token operator">.</span>ht <span class="token punctuation">{</span>
 #   deny <span class="token keyword">all</span><span class="token punctuation">;</span>
 # <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>把原本转发给 <code>Tomcat</code>(JAVA环境作为参考) 的 <code>8080</code> 端口改为 iptables 中开放的接口（eg. 8888）</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code> location ~ <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token operator">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">;</span>
    <span class="token builtin">include</span> proxy<span class="token operator">.</span><span class="token keyword">conf</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="docker-端口映射-2"><a href="#docker-端口映射-2" class="header-anchor">#</a> docker 端口映射</h5> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ sudo docker run <span class="token operator">-</span>it <span class="token operator">-</span><span class="token keyword">p</span> <span class="token number">8888</span><span class="token punctuation">:</span><span class="token number">80</span> <span class="token operator">-</span><span class="token keyword">p</span> <span class="token number">6666</span><span class="token punctuation">:</span><span class="token number">3306</span> web <span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>-p 8888:80</code> : 将容器的<code>80</code>端口映射到主机的<code>8888</code>端口（与上面的反向代理的端口号一致）。</p> <p>这样设置后，访问宿主机的<code>8888</code>端口就可以访问到容器的<code>80</code>端口，可以测试一下：</p> <div class="language-vim line-numbers-mode"><pre class="language-vim"><code>$ curl http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token operator">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">8888</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>正常情况下会访问到容器的<code>80</code>端口，并打印出容器 web 默认目录（<code>/data/wwwroot/default</code>）下的 <code>index.html</code> 中的内容。</p> <p>如果出现异常，则需要一步步排查问题，最有可能的是容器内的 web 服务没有启动，可以进入容器，检查一下 nginx、tomcat 等 web 服务器和容器的状态，或者直接 <code>restart</code> 即可。</p> <p>而把容器的<code>3306</code>端口映射到宿主机的<code>6666</code>端口，就可以通过绑定的域名和<code>6666</code>端口，访问容器里的 MySQL 数据库。</p> <p>还需要映射什么端口根据需求去配置即可。</p> <h3 id="项目部署"><a href="#项目部署" class="header-anchor">#</a> 项目部署</h3> <p>最后的最后，只要把项目部署在容器里就完成了。作为运维相信这根本就不是什么问题了。比如说 JavaEE 项目，把项目的 war 包部署到 <code>/data/wwwroot/</code> 下对应域名的文件夹里，就可以通过域名访问容器里的项目了。</p> <p>PHP-fpm、Node.js 什么的就不说啦。</p> <h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <p>理论上来说，一台服务器有65536个端口号，就算一个环境需要映射10个端口，那也可以构建6000个容器。实际上还得看带宽、硬盘容量等的配置，但也已经足够应付几十个项目的环境构建了。这种虚拟化技术简直不能太爽，有一种一台云主机 ECS 被分成了 N 台 VPS 的体验。</p> <p>关于项目的环境，在 Docker 的帮助下，开发环境、测试环境、生产环境都可以部署在同一台服务器上，数据不共通，但配置完全相同。并且，如果要迁移服务器，将是直接复制粘贴的操作，几秒钟就可以完成。</p> <p>迭代版本号：测试环境 &gt; 生产环境 (开发环境不打tag)
版本稳定性：生产环境 &gt; 测试环境 &gt; 开发环境</p> <p>关于版本迭代流程控制：</p> <ul><li>后端每开发完一个模块或者完成一个功能甚至只修了一个BUG，都要将代码更新到 <code>dev</code> 分支，部署到开发环境。</li> <li>前端一般情况下，接开发环境的API。</li> <li>前端完成某个模块，需要进行测试，后端就发布一个测试版本到 <code>test</code> 分支，打上tag，eg.  <code>v0.3.TEST</code>，部署到测试环境。</li> <li>前端切换到测试环境的 API，发布前端测试版本。</li> <li>QA 拿到前端测试版本，开始测试。</li> <li>前端切回测试环境，前后端继续开发。</li> <li>QA 测试通过。</li> <li>后端将测试环境的代码发布到 <code>master</code> 分支，打上tag，eg. <code>v0.3.RELEASE</code>, 部署到生产环境。</li> <li>...</li> <li>前端接生产环境的API。</li> <li>项目完成。</li></ul> <h2 id="todo"><a href="#todo" class="header-anchor">#</a> TODO</h2> <ul><li>Docker + Git + Jenkins 持续构建部署</li> <li>构建容器集群</li></ul></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/4/2020, 2:59:10 PM</span></div></footer> <!----></main> <!----> <div style="display:none;" data-v-21b9510f data-v-21b9510f><div class="comments-wrapper" data-v-21b9510f><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-1e128e82 data-v-1e128e82><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-1e128e82><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-1e128e82></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-1e128e82></path></svg></div></div></div>
    <script src="/assets/js/app.2cce0900.js" defer></script><script src="/assets/js/3.89e13237.js" defer></script><script src="/assets/js/1.70547aa9.js" defer></script><script src="/assets/js/43.b97d0a10.js" defer></script>
  </body>
</html>
